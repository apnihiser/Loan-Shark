<!doctype html>
<html lang="en" class="h-100">

<head>
    <title>LOAN SHARK: A CODING EXERCISE</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <script src="https://kit.fontawesome.com/5db21ba9c6.js" crossorigin="anonymous"></script>
    
    <link href="/css/site.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="/img/favicon.ico">

    <link href="css/prism.css" rel="stylesheet">
    
</head>

<body class="d-flex flex-column h-100">
    <!-- ==== Nav Section ==== -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand navAppFont" href="#"><img src="/img/LS-ICON.png" class="d-inline-block align-text-top" alt="LOAN SHARK Logo" width="38" height="38"> LOAN SHARK</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/app.html">The App</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/code.html">The Code</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" target="_blank" href="https://anihiser-portfolio.netlify.app/">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" target="_blank" href="https://anihiser-portfolio.netlify.app/">Git Repo</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- ==== Main Section ==== -->
    <main class="flex-shrink-0">
        <div class="container py-5 px-5 mt-5">
            <H2 class="border-1 border-bottom border-dark">The Code for APP NAME.</H2>
            <div class="row row-cols-1 row-cols-lg-2">
                <div class="col-lg-8">
                    <pre class="line-numbers"><code class="language-javascript">
                        //Controller function
                        //gather data from webform
                        function getValues() {

                            let loanTerms = {};
                            //define principle
                            loanTerms.principal = parseInt(document.getElementById("inputLoanAmount").value);
                            //define number of payments 12 per year by Month
                            loanTerms.numberMonths = parseInt(document.getElementById("inputTermLength").value);
                            //define loan rate / 100 per month / per days
                            loanTerms.rate = parseInt(document.getElementById("inputInterestRate").value);
                            
                            //form is validating numbers but we do a check here to ensure there is a value provided as well
                            if ( !Number.isInteger(loanTerms.principal) || !Number.isInteger(loanTerms.numberMonths) || !Number.isInteger(loanTerms.rate) ) {

                                alert("Please check your entries and try again.")

                            } else {

                                //Convert loan rate into APR that will compound monthly.
                                loanTerms.rate = loanTerms.rate / 1200;

                                //perform value computations and return object that describe the amortization Table
                                let amorTable = generateTable(loanTerms);

                                //accept object and display components
                                displayValues(loanTerms, amorTable);

                            }
                        }

                        function generateTable(loanRequest) {

                            //Define Terms for Monthly Payment Formula
                            let p = loanRequest.principal;
                            let r = loanRequest.rate
                            let n = loanRequest.numberMonths

                            //Define Terms for Amortization Table
                            let amorTable = {};
                            
                            //Solve for Monthly Payment using the following: m = ( p * r ) / ( 1 - ( 1 + r ) ^ -n ) p=principle, r=rate (APR 5% would be .05 per year or .05/12 per month), n=loan term in months
                            amorTable.monthlyPayment = ( p * r ) / ( 1 - Math.pow(1 + r, -n) );

                            //Create Balance sheet
                            amorTable.balance = p;

                            //Solve for Total Cost on the loan
                            amorTable.totalCost = ( amorTable.monthlyPayment * n );

                            //Solve for Total Interest on the loan
                            amorTable.totalInterest = amorTable.totalCost - loanRequest.principal;
                            amorTable.currentInterest = 0;

                            return amorTable;

                        }

                        //Use information from amorTable to determine and append to HTML Table Body
                        function displayValues(loanTerms, amorTable) {

                                //Use this to 
                                const formatter = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                minimumFractionDigits: 2
                                })

                                //Write results to the summary section of the application page
                                document.getElementById("payment").innerHTML =  formatter.format(amorTable.monthlyPayment);
                                document.getElementById("principal").innerHTML = formatter.format(loanTerms.principal);
                                document.getElementById("interest").innerHTML = formatter.format(amorTable.totalInterest);
                                document.getElementById("cost").innerHTML = formatter.format(amorTable.totalCost);

                                //get the table body element from the page
                                let tableBody = document.getElementById("results");

                                //get the template row
                                let templateRow = document.getElementById("lsTemplate");

                                //clear tablebody
                                tableBody.innerHTML = "";

                                //Loop to create table out of the data created from the loan terms and amortization object.
                                for ( let i = 1; i <= loanTerms.numberMonths; i++) {

                                    //Each loop grab the template and import the table row.
                                    let tableRow = document.importNode(templateRow.content, true);

                                    //grab just the tds and put them into an array
                                    let rowCols = tableRow.querySelectorAll("td");

                                    //Calculate final information to the written to the table body results
                                    interestPayment = amorTable.balance * loanTerms.rate;
                                    amorTable.currentInterest += interestPayment;
                                    principalPayment = amorTable.monthlyPayment - interestPayment;
                                    amorTable.balance -= principalPayment;

                                    //fill template array with information
                                    rowCols[0].textContent = i;
                                    rowCols[1].textContent = formatter.format(amorTable.monthlyPayment);
                                    rowCols[2].textContent = formatter.format(principalPayment);
                                    rowCols[3].textContent = formatter.format(interestPayment);
                                    rowCols[4].textContent = formatter.format(amorTable.currentInterest);
                                    rowCols[5].textContent = formatter.format(amorTable.balance);

                                    //Append to Table body
                                    tableBody.appendChild(tableRow);

                            }
                        }
                        </code>
                    </pre>
                </div>
                <div class="col-lg-4">
                    <h5>Loan Shark: Application Breakdown</h5>
                    <p>Loan Shark is an interactive application which will accept data from a data form, calculate an amortization table with full payment schedules. This information is display from a table javascript writes into. These actions are based off a acontroller function, logic function and display function. This will seperate the areas of concern from each other to provide scalability and ease of troubleshooting.</p>
                    <h6>Controller function</h6>
                    <p>The controller function will be called when the user presses the calculate button. Once called the controller function will parse the values provide by the user into integers. If no value is provided then an alert will pop asking to the user to try again. Once valid data has been provided then the logic and display functions will be called.</p>
                    <h6>Logic Function</h6>
                    <p>The logic function accepts the loan object which contains the principal, rate, and term length in months. This loan will compount monthly so the formula will look like this:<br><br><math class="fst-italic fw-bolder">Monthly Payment = ( Principal * Rate ) / ( 1 - ( 1 + Rate ) ^-Term Length )</math><br><br>An amortization object is create with the following items to describe it:</p>
                    <ul>
                        <li>Montly Payment</li>
                        <li>Balance</li>
                        <li>Total Cost</li>
                        <li>Total Interest</li>
                        <li>Current Interest Payment Tally</li>
                    </ul>
                    <p>Once this object has been created and values calculated it will be passed to the display function via the controller function.</p>
                    <h6>Display Function</h6>
                    <p>The display function's main feature is it's ability to pull the results table body, as well as a template and fill in the attributes from the the amortization object. Then write into the results table body. Since we will be using financial figures the formatter function was used here. The summary of the loan schedule is located above the amortization detailed schedule. This is written into the DOM by use of the  innerHTML method.</p>
                    <p>To write out the detailed table we will need to create a for loop which will go through each month and calculate out from the amortization object. The math is descried in the code box. Once the table to be written to and the template have been captured per month each line will calculate and append to the tablebody the template table row.</p>
                </div>
            </div>
        </div>
    </main>
     <!-- ==== Footer Section ==== -->
     <footer class="footer mt-auto py-3 sticky-footer">
        <div class="container-fluid">
            <div class="row row-cols-1 row-cols-lg-3 gy-2">
                <div class="col order-last order-lg-first text-light d-flex align-items-center justify-content-start">
                    <div><span class="text-muted">&copy;2021</span> Adam Nihiser | anihiser@gmail.com</div>
                </div>
                <div class="col d-flex align-items-center justify-content-start justify-content-lg-center">
                    <img src="/img/adam_p_nihiser_logo_notitle.png" alt="Adam Nihiser Logo" height="48">
                </div>
                <div class="col d-flex align-items-center justify-content-start justify-content-lg-end">
                    <div class="row">
                        <div class="col social"><a href="https://www.linkedin.com/in/anihiser/" target="_blank"><i class="fab fa-linkedin fa-2x"></i></a></div>
                        <div class="col social"><a href="https://github.com/apnihiser" target="_blank"><i class="fab fa-github fa-2x"></i></a></div>
                        <div class="col social"><a href="https://twitter.com/MerkkieMer" target="_blank"><i class="fab fa-twitter fa-2x"></i></a></div>
                        <div class="col social"><a href="https://www.youtube.com/channel/UCZl9auJaZm4S3sOHCBcxgEQ" target="_blank"><i class="fab fa-youtube fa-2x"></i></a></div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
    </script>
    <script src="js/prism.js"></script>
    <script>
        Prism.plugins.NormalizeWhitespace.setDefaults({
        'remove-trailing': true,
        'remove-indent': true,
        'left-trim': true,
        'right-trim': true
        })
    </script>

</body>

</html>